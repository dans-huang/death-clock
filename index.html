<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Life in Weeks</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            background-color: #000000;
            font-family: 'Inter', sans-serif;
        }
        
        .event-future {
            animation: event-pulse-future 4s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }
        
        @keyframes event-pulse-future {
            0%, 100% {
                background-color: rgb(156 163 175); /* bg-gray-400 - same as normal future */
            }
            50% {
                background-color: rgb(107 114 128); /* bg-gray-500 - distinguishable */
            }
        }
        
        .event-past {
            animation: event-pulse-past 4s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }
        
        @keyframes event-pulse-past {
            0%, 100% {
                background-color: rgb(31 41 55); /* bg-gray-800 - same as normal past */
            }
            50% {
                background-color: rgb(75 85 99); /* bg-gray-600 - distinguishable */
            }
        }
    </style>
</head>
<body class="min-h-screen p-6" style="background-color: #000000; font-family: 'Inter', sans-serif;">
    <!-- Input fields - shown on hover over title when visualization is active -->
    <div class="fixed top-0 left-0 right-0 z-10 flex justify-center" 
         style="display: none;" id="hoverInputs"
         onmouseleave="showInputs = false; updateInputVisibility();">
        <div class="mt-6">
            <div class="bg-gray-900 rounded-lg p-4 space-y-4 border border-gray-700" style="min-width: 16rem;">
                <h3 class="text-gray-300 font-normal text-xs">Life in Weeks Setup</h3>
                
                <div class="space-y-2">
                    <label class="text-gray-400 text-xs block">Birthday</label>
                    <input id="birthdateInputHover" type="date" 
                           onchange="birthdate = this.value; handleGenerate();"
                           class="w-full p-2 bg-gray-800 rounded text-gray-100 text-sm focus:bg-gray-700 focus:outline-none transition-all"
                           style="border: none;">
                </div>
                
                <div class="space-y-2">
                    <label class="text-gray-400 text-xs block">Estimated Lifespan (years)</label>
                    <input id="lifespanInputHover" type="number" min="1" max="120"
                           onchange="lifespan = parseInt(this.value); handleGenerate();"
                           class="w-full p-2 bg-gray-800 rounded text-gray-100 text-sm focus:bg-gray-700 focus:outline-none transition-all"
                           style="border: none;">
                </div>
                
                <button onclick="handleGenerate()"
                        class="w-full bg-gray-700 hover:bg-gray-600 text-gray-200 py-2 px-4 rounded text-xs font-normal transition-colors">
                    Update Visualization
                </button>
            </div>
        </div>
    </div>

    <!-- Main content -->
    <div class="max-w-4xl mx-auto">
        <div id="app"></div>
        <div id="mainContent"></div>
    </div>

    <script>
        let stats = null;
        let birthdate = '';
        let lifespan = 80;
        let showVisualization = false;
        let showInputs = true;
        let events = {};
        let selectedWeek = null;

        function calculateStats(date, totalYears) {
            const birthDate = new Date(date);
            const today = new Date();
            
            const msInWeek = 1000 * 60 * 60 * 24 * 7;
            const weeksLived = Math.floor((today - birthDate) / msInWeek);
            
            const totalWeeks = totalYears * 52;
            const weeksRemaining = totalWeeks - weeksLived;
            const percentageLived = Math.round((weeksLived / totalWeeks) * 100);
            
            const msInDay = 1000 * 60 * 60 * 24;
            const daysLived = Math.floor((today - birthDate) / msInDay);
            const daysRemaining = (totalYears * 365) - daysLived;
            
            const yearsLived = Math.floor((today - birthDate) / (1000 * 60 * 60 * 24 * 365.25));
            const yearsRemaining = totalYears - yearsLived;
            
            return {
                weeksLived,
                totalWeeks,
                weeksRemaining,
                percentageLived,
                daysLived,
                daysRemaining,
                yearsLived,
                yearsRemaining
            };
        }

        function getFormattedNumber(num) {
            return new Intl.NumberFormat().format(num);
        }

        function getWeekDateRange(weekNumber) {
            const birthDate = new Date(birthdate);
            const weekStart = new Date(birthDate.getTime() + (weekNumber * 7 * 24 * 60 * 60 * 1000));
            const weekEnd = new Date(weekStart.getTime() + (6 * 24 * 60 * 60 * 1000));
            
            const formatDate = (date) => {
                const month = (date.getMonth() + 1).toString().padStart(2, '0');
                const day = date.getDate().toString().padStart(2, '0');
                return `${month}/${day}`;
            };
            
            const startFormatted = formatDate(weekStart);
            const endFormatted = formatDate(weekEnd);
            const year = weekStart.getFullYear();
            
            // Calculate age during this week
            const age = Math.floor((weekStart - birthDate) / (1000 * 60 * 60 * 24 * 365.25));
            
            return `${startFormatted}~${endFormatted}, ${year} (age ${age})`;
        }

        function renderWeekGrid(stats) {
            const weeksPerColumn = 52;
            const totalColumns = parseInt(lifespan);
            const rows = [];
            
            for (let row = 0; row < weeksPerColumn; row++) {
                const weekCells = [];
                
                for (let col = 0; col < totalColumns; col++) {
                    const weekNumber = col * weeksPerColumn + row;
                    
                    if (weekNumber < stats.totalWeeks) {
                        const isPast = weekNumber < stats.weeksLived;
                        const isCurrent = weekNumber === stats.weeksLived;
                        const hasEvent = events[weekNumber];
                        
                        let cellClass = "w-2 h-2 m-0.5 rounded-full transition-all cursor-pointer ";
                        if (isPast) {
                            cellClass += hasEvent ? "event-past" : "bg-gray-800";
                        } else if (isCurrent) {
                            cellClass += "bg-orange-500 animate-pulse";
                        } else {
                            cellClass += hasEvent ? "event-future" : "bg-gray-400";
                        }
                        
                        weekCells.push(`<div class="${cellClass}" onclick="handleWeekClick(${weekNumber})" title="${hasEvent ? events[weekNumber] : 'Week ' + (weekNumber + 1)}"></div>`);
                    }
                }
                
                rows.push(`<div class="flex">${weekCells.join('')}</div>`);
            }
            
            return `
                <div class="flex flex-col items-center">
                    <h2 class="text-lg font-medium mb-4 text-gray-100" style="cursor: default;" onmouseenter="showInputs = true; updateInputVisibility();">Life in weeks</h2>
                    <div class="flex flex-col items-center">
                        ${rows.join('')}
                    </div>
                    
                    <div class="grid grid-cols-2 gap-8 text-gray-300 mt-12">
                        <div class="space-y-3">
                            <h3 class="text-md font-medium text-gray-100 mb-3">Time lived</h3>
                            <div class="space-y-2">
                                <p><span class="text-gray-400">Years:</span> <span class="text-gray-300 font-mono">${stats.yearsLived}</span></p>
                                <p><span class="text-gray-400">Weeks:</span> <span class="text-gray-300 font-mono">${getFormattedNumber(stats.weeksLived)}</span></p>
                                <p><span class="text-gray-400">Days:</span> <span class="text-gray-300 font-mono">${getFormattedNumber(stats.daysLived)}</span></p>
                                <p><span class="text-gray-400">Progress:</span> <span class="text-gray-300 font-mono">${stats.percentageLived}%</span></p>
                            </div>
                        </div>
                        
                        <div class="space-y-3">
                            <h3 class="text-md font-medium text-gray-100 mb-3">Time remaining</h3>
                            <div class="space-y-2">
                                <p><span class="text-gray-400">Years:</span> <span class="text-gray-300 font-mono">${stats.yearsRemaining}</span></p>
                                <p><span class="text-gray-400">Weeks:</span> <span class="text-gray-300 font-mono">${getFormattedNumber(stats.weeksRemaining)}</span></p>
                                <p><span class="text-gray-400">Days:</span> <span class="text-gray-300 font-mono">${getFormattedNumber(stats.daysRemaining)}</span></p>
                                <p><span class="text-gray-400">Remaining:</span> <span class="text-gray-300 font-mono">${100 - stats.percentageLived}%</span></p>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        function handleGenerate() {
            if (birthdate && lifespan) {
                localStorage.setItem('lifeWeeks_birthdate', birthdate);
                localStorage.setItem('lifeWeeks_lifespan', lifespan.toString());
                
                stats = calculateStats(birthdate, parseInt(lifespan));
                showVisualization = true;
                showInputs = false;
                
                document.getElementById('app').innerHTML = renderWeekGrid(stats);
                updateInputVisibility();
                updateMainContent();
            }
        }

        function handleWeekClick(weekNumber) {
            selectedWeek = weekNumber;
            showEventPopup();
        }

        function showEventPopup() {
            const eventName = events[selectedWeek] || '';
            const modal = `
                <div id="eventModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-20" onclick="handleEventCancel()">
                    <div class="bg-gray-900 border border-gray-700 rounded-lg p-6" style="min-width: 20rem;" onclick="event.stopPropagation()">
                        <h3 class="text-gray-100 font-medium text-sm mb-4">
                            Add Event - ${getWeekDateRange(selectedWeek)}
                        </h3>
                        <input
                            id="eventNameInput"
                            type="text"
                            value="${eventName}"
                            placeholder="Event name"
                            class="w-full p-2 bg-gray-800 border border-gray-600 rounded text-gray-100 text-sm focus:border-orange-500 focus:outline-none mb-4"
                            onkeydown="handleEventKeydown(event)"
                        />
                        <div class="flex gap-2">
                            <button
                                onclick="handleEventSave()"
                                class="flex-1 bg-gray-300 hover:bg-gray-200 text-gray-900 py-2 px-4 rounded text-sm transition-colors"
                            >
                                Save
                            </button>
                            <button
                                onclick="handleEventClear()"
                                class="flex-1 bg-gray-700 hover:bg-gray-600 text-gray-200 py-2 px-4 rounded text-sm transition-colors"
                            >
                                Clear
                            </button>
                        </div>
                    </div>
                </div>
            `;
            document.body.insertAdjacentHTML('beforeend', modal);
            document.getElementById('eventNameInput').focus();
        }

        function handleEventKeydown(event) {
            if (event.key === 'Enter') handleEventSave();
            if (event.key === 'Escape') handleEventCancel();
        }

        function handleEventSave() {
            const eventNameInput = document.getElementById('eventNameInput');
            const eventName = eventNameInput.value.trim();
            
            if (eventName) {
                events[selectedWeek] = eventName;
            } else {
                delete events[selectedWeek];
            }
            
            localStorage.setItem('lifeWeeks_events', JSON.stringify(events));
            handleEventCancel();
            
            // Refresh the visualization
            document.getElementById('app').innerHTML = renderWeekGrid(stats);
        }

        function handleEventClear() {
            delete events[selectedWeek];
            localStorage.setItem('lifeWeeks_events', JSON.stringify(events));
            handleEventCancel();
            
            // Refresh the visualization
            document.getElementById('app').innerHTML = renderWeekGrid(stats);
        }

        function handleEventCancel() {
            const modal = document.getElementById('eventModal');
            if (modal) {
                modal.remove();
            }
            selectedWeek = null;
        }

        function updateInputVisibility() {
            const hoverInputs = document.getElementById('hoverInputs');
            
            if (showVisualization) {
                if (showInputs) {
                    hoverInputs.style.display = 'flex';
                } else {
                    hoverInputs.style.display = 'none';
                }
            }
        }

        function updateMainContent() {
            const mainContent = document.getElementById('mainContent');
            if (!showVisualization) {
                mainContent.innerHTML = `
                    <div class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-10">
                        <div class="bg-gray-900 rounded-lg p-6 space-y-4 border border-gray-700" style="min-width: 20rem;">
                            <h3 class="text-gray-300 font-normal text-lg text-center mb-6">Life in Weeks Setup</h3>
                            
                            <div class="space-y-2">
                                <label class="text-gray-400 text-sm block">Birthday</label>
                                <input id="birthdateInput" type="date" 
                                       onchange="birthdate = this.value"
                                       class="w-full p-3 bg-gray-800 rounded text-gray-100 text-sm focus:bg-gray-700 focus:outline-none transition-all"
                                       style="border: none;">
                            </div>
                            
                            <div class="space-y-2">
                                <label class="text-gray-400 text-sm block">Estimated Lifespan (years)</label>
                                <input id="lifespanInput" type="number" value="80" min="1" max="120"
                                       onchange="lifespan = parseInt(this.value)"
                                       class="w-full p-3 bg-gray-800 rounded text-gray-100 text-sm focus:bg-gray-700 focus:outline-none transition-all"
                                       style="border: none;">
                            </div>
                            
                            <button onclick="handleGenerate()"
                                    class="w-full bg-gray-700 hover:bg-gray-600 text-gray-200 py-3 px-4 rounded text-sm font-normal transition-colors mt-6">
                                Generate Visualization
                            </button>
                        </div>
                    </div>
                `;
            } else {
                mainContent.innerHTML = '';
            }
        }

        function loadSavedData() {
            const savedBirthdate = localStorage.getItem('lifeWeeks_birthdate');
            const savedLifespan = localStorage.getItem('lifeWeeks_lifespan');
            const savedEvents = localStorage.getItem('lifeWeeks_events');
            
            if (savedEvents) {
                events = JSON.parse(savedEvents);
            }
            
            if (savedBirthdate && savedLifespan) {
                birthdate = savedBirthdate;
                lifespan = parseInt(savedLifespan);
                stats = calculateStats(birthdate, lifespan);
                showVisualization = true;
                showInputs = false;
                
                document.getElementById('birthdateInputHover').value = birthdate;
                document.getElementById('lifespanInputHover').value = lifespan;
                document.getElementById('app').innerHTML = renderWeekGrid(stats);
                updateInputVisibility();
                updateMainContent();
            }
        }

        // Initialize the app
        document.addEventListener('DOMContentLoaded', function() {
            const hasSavedData = localStorage.getItem('lifeWeeks_birthdate') && localStorage.getItem('lifeWeeks_lifespan');
            
            if (hasSavedData) {
                loadSavedData();
            } else {
                // Show input panel for first-time users
                showInputs = true;
                updateInputVisibility();
                updateMainContent();
            }
        });
    </script>
</body>
</html>
